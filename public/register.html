<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Criar conta | AgendaBarber</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-slate-950 flex items-center justify-center min-h-screen">

<div class="bg-slate-900 p-8 rounded-xl w-96">
  <h2 class="text-2xl text-white font-bold mb-6 text-center">
    Criar conta
  </h2>

  <input id="nome" class="w-full p-3 mb-3 rounded bg-slate-800 text-white"
         placeholder="Seu nome">

  <input id="email" class="w-full p-3 mb-3 rounded bg-slate-800 text-white"
         placeholder="Email">

  <input id="password" type="password"
         class="w-full p-3 mb-3 rounded bg-slate-800 text-white"
         placeholder="Senha">

  <select id="role"
          class="w-full p-3 mb-3 rounded bg-slate-800 text-white">
    <option value="admin">Dono da Barbearia</option>
    <option value="barbeiro">Barbeiro</option>
    <option value="cliente">Cliente</option>
  </select>

  <div id="divNomeBarbearia" class="mb-3">
    <input id="nomeBarbearia"
           class="w-full p-3 rounded bg-slate-800 text-white"
           placeholder="Nome da sua barbearia">
  </div>

  <button id="btnRegister"
          class="w-full bg-green-500 text-black py-3 rounded font-semibold">
    Criar conta
  </button>
</div>

<script type="module">
import { supabase } from './js/supabase.js'
import { register } from './js/auth.js'

const role = document.getElementById('role')
const divNomeBarbearia = document.getElementById('divNomeBarbearia')
const nomeBarbearia = document.getElementById('nomeBarbearia')

role.addEventListener('change', () => {
  if (role.value === 'admin') {
    divNomeBarbearia.classList.remove('hidden')
  } else {
    divNomeBarbearia.classList.add('hidden')
    nomeBarbearia.value = ''
  }
})

document.getElementById('btnRegister').onclick = async () => {
  const nome = document.getElementById('nome').value.trim()
  const email = document.getElementById('email').value.trim()
  const password = document.getElementById('password').value

  if (!nome || !email || !password) {
    alert('Preencha todos os campos')
    return
  }

  if (role.value === 'admin' && !nomeBarbearia.value.trim()) {
    alert('Informe o nome da barbearia')
    return
  }

  try {
    // Registrar com dados - Supabase criará profile e barbearia via trigger
    const { error } = await register(email, password, {
      nome,
      role: role.value,
      nome_barbearia: nomeBarbearia.value.trim() || null
    })

    if (error) {
      alert('Erro ao criar conta: ' + error.message)
      return
    }

    alert('Conta criada com sucesso! Faça login para continuar.')
    window.location.href = 'login.html'
  } catch (error) {
    alert('Erro: ' + error.message)
  }
}
</script>


</body>
</html>
